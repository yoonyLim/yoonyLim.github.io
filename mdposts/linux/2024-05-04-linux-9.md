---
title: "리눅스로 한 학기 살기 9주차"
subtitle: "Go 언어 및 gRPC듈 모듈 설치 및 실행"
date: "2024-05-04"
---

# [리눅스] 리눅스로 한 학기 살기 - 9주차: Go 언어 및 gRPC듈 모듈 설치 및 실행

## 1. 개요

### 1.1 사전 배경

gRPC는 구글이 2016년 8월에 오픈 소스로 공개한 Remote Procedure Call (RPC)의 프레임워크로 다양한 환경과 프로그래밍 언어 간에서도 작동할 수 있도록 설계되었다.<sup>[1)](#ref1)</sup> 구글은 이미 gRPC의 이전 버전이라 할 수 있는 Stubby를 여러 데이터 센터 간 마이크로서비스들의 통신을 위해 어용해 왔다.<sup>[2)](#ref2)</sup> Stubby와 gRPC는 모두 RPC 기반이고 이는 이름이 갖는 의미와 같이 분산 네트워크 환경에서 원격지 컴퓨터의 함수를 호출하여 통신하는 프로토콜을 사용한다. 이때 gRPC는 클라이언트 쪽의 stub을 사용하여 원격으로 함수를 호출하고 해당 요청과 요청에 따라 응답을 전달하는 방식은 Protocol Buffers를 사용하여 시리얼라이즈된 구조적 데이터를 나르는 방식을 취한다.<sup>[3)](#ref3)</sup>

앞선 내용을 바탕으로 gRPC는 Protobuf를 사용하여 데이터를 압축하여 바이너리 형태로 전달할 수 있고 엄격한 구조화 덕분에 빠른 통신 속도를 낼 수 있다.(알맞은 설정 및 환경이라는 가정 하에) 또한 클라이언트와 서버 쪽에서의 단방향 스트리밍 지원 뿐 아니라 양방향 스트리밍 또한 지원한다. 다만 protocol buffer comiler (protoc)를 이용하여 컴파일 후 프로토 파일들을 사용하여 구조화된 통신을 진행하기에 웹브라우저에서의 사용은 아직 제약이 존재한다.(WebAssembly를 통하면 이제 가능할지도 모르겠다.) 이러한 특징들은 gRPC가 마이크로서비스 구조, 모바일 앱-백엔드 통신, 서버 간 통신 등에서 특화되어 사용될 수 있는 이점을 보여준다.

### 1.2 수행 요약

본인은 해당 gRPC를 사용하여 통신하는 과제를 수행할 겸 해당 수행을 리눅스 커널의 환경에서도 시험해 보았다. gRPC는 다양한 프로그래밍 언어를 지원하지만 그중에서도 네트워크 통신에 특화되었다 할 수 있는 Go 언어를 선택하여 수행했다. 따라서 본인은 아치 리눅스에 Go 언어와 gRPC 모듈 및 기타 필요한 패키지들을 설치한 뒤 설정을 마쳐야 했다. 이후 간단한 통신을 시작으로  gRPC의 결과를 확인했다.

## 2. Go 언어 및 gRPC 모듈 설치

### 2.1 Go 언어 설치

아치 리눅스에서 Go 언어를 설치하기 위해서는 에터미널에서 아래의 커맨드를 통해 Go 언어를 패키지 매니저를 통해 설치하면 된다. 아치 리눅스가 아닌 리눅스 호나경에서는 다른 패키지 매니저들이 설치를 지원하니 따로 찾아볼 필요가 있다.

```bash
$ sudo pacman -S go
```

이후 터미널에서 아래의 명령어를 입력했을 때 Go 언어의 버전에 제대로 출력된다면 성공적으로 설치가 진행된 것이다.

```bash
$ go version
go version go1.22.3 linux/amd64
```

이후 Go 언어를 쉽게 호출해서 사용하기 위해 경로를 PATH 환경 변수로 설정할 필요가 있다. 아래와 같은 내용을영 vim이나 nano를 사용하여 `~/.bashrc`에 추가하면 된다.

설정 파일 열기:

```
$ vim ~/.bashrc
```

아래의 줄 추가:

```
export PATH=$PATH:/usr/local/go/bin
```

그리고 설정을 반영하기 위해 아래의 명령어를 실행한다:

```
$ source ~/.bashrc
```

### 2.2 gRPC 모듈 설치

Go 언어의 설치가 끝났으니 이제 gRPC 모듈 및 필요 패키지들을 설치할 차례이다. 우선 아래 명령어를 통해 필요 gRPC 모듈들을 설치한다. 명령어 뒤 `@` 뒤에 특정 버전을 명시하여 해당 버전의 gRPC 모듈을 설치할 수도 있다.

우선 Protocol Buffer 모듈을 설치한다:

```bash
$ go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
```

그리고 gRPC 모듈을 설치한다:

```bash
$ go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
```

해당 모듈 및 패키지들은 프로젝트 단에서 필요한 것이니 우선 프로젝트를 생성할 필요가 있다. 아래와 같은 순서를 프로젝트를 생성 및 작성 후 gRPC 모듈 및 필요 패키지들을 설치한 뒤 실행할 수 있다.

1. 프로젝트에 필요한 `proto` 파일을 생성한다. 해당 파일의 이름은 프로젝트에서 Protocol Buffer의 파일들이 가질 패키지명을 사용하여 "[PKG_NAME].proto"의 이름으로 생성하면 된다.

2. 해당 패키지들이 속할 디렉토리를 아래의 명령어로 생성하거나 GUI 창에서 직접 생성한다.

```bash
$ mkdir [PKG_NAME]
```

3. 처음 생성한 "[PKG_NAME].proto"를 protoc를 사용하여 컴파일한다.

```bash
$ protoc --go_out=[PKG_NAME] --go_opt=paths=source_relative --go-grpc_out=[PKG_NAME] --go-grpc_opt=paths=source_relative [PROTOBUF_NAME].proto
```

4. 패키지명과 같은 이름으로 go module 파일을 생성한다. 이에 따라 프로젝트가 올바른 경로를 통해 패키지를 인식할 수 있게 된다.

```bash
$ go mod init [PKG_NAME]
```

해당 모듈 파일을 보기 좋게 만들고 싶으면 아래 명령어를 입력한다.

```bash
$ go mod tidy
```

5. 프로젝트 내부에서 설치한 gRPC 패키지를 불러온다.

```bash
$ go get -u google.golang.org/grpc
```

6. 이후 통신할 서버와 클라이언트의 코드를 짜고 각자 다른 터미널에서 실행시켜 통신하는 결과를 확인하면 된다. 본인의 경우 서버를 `server.go`, 클라이언트를 `client.go`로 작성했기에 아래의 명령어를 각 터미널에서 실행시면 되었다.

서버 실행:

```bash
$ go run server.go
```

클라이언트 실행:

```bash
$ go run client.go
```

아래는 최종적으로 본인이 Go 언어로 작성한 클라이언트가 요청으로 보내는 숫자의 제곱으로 응답하는 gRPC 서버와 클라이언트 간 통신 결과이다.

![img0](/images/linux/20240504/img0.png)

***업데이트: 이후 양방향 스트리밍, 클라이언트 스트리밍, 서버 스트리밍 예제를 구현했다. 해당 코드는 본인의 [GitHub 리포지토리](https://github.com/yoonyLim/gRPCGolangSamples)에서 확인 가능하다.***

## 3. References

<a id="ref1"></a>
1. gRPC Authors, ["About gRPC"](https://grpc.io/)
<a id="ref2"></a>
2. Varun Talwar, ["gRPC: a True Internet-scale RPC FrameworkIs Now 1.0 and Ready for Production Deployments"](https://cloud.google.com/blog/products/gcp/grpc-a-true-internet-scale-rpc-framework-is-now-1-and-ready-for-production-deployments), Google Cloud, 2016년 8월 24일.
